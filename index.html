<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi定位与地图显示</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .card-header {
            background: #4a5568;
            color: white;
            padding: 15px 20px;
            font-size: 1.3rem;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }
        
        .status-panel {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
        }
        
        .status-item {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .status-label {
            font-weight: 600;
        }
        
        .status-value {
            color: #4a5568;
        }
        
        #map {
            height: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .wifi-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            background: #f7fafc;
        }
        
        .wifi-item {
            padding: 8px 10px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        .wifi-item:last-child {
            border-bottom: none;
        }
        
        .wifi-ssid {
            font-weight: 600;
        }
        
        .wifi-strength {
            color: #4a5568;
        }
        
        .accuracy-circle {
            stroke: #4299e1;
            stroke-width: 2;
            fill: rgba(66, 153, 225, 0.1);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WiFi定位与地图显示</h1>
            <p class="subtitle">使用浏览器定位功能在地图上显示您的位置</p>
        </header>
        
        <div class="app-container">
            <div class="control-panel">
                <div class="card">
                    <div class="card-header">控制面板</div>
                    <div class="card-body">
                        <button id="locate-btn" class="btn btn-primary">
                            <span class="loading hidden"></span>
                            开始定位
                        </button>
                        <button id="simulate-btn" class="btn btn-success">使用模拟数据</button>
                        <button id="reset-btn" class="btn btn-danger">重置地图</button>
                        
                        <div class="status-panel">
                            <h3>定位状态</h3>
                            <div class="status-item">
                                <span class="status-label">定位状态:</span>
                                <span id="status" class="status-value">等待定位...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">纬度:</span>
                                <span id="latitude" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">经度:</span>
                                <span id="longitude" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">精度:</span>
                                <span id="accuracy" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">检测到的WiFi网络:</span>
                                <span id="wifi-count" class="status-value">0</span>
                            </div>
                        </div>
                        
                        <div class="wifi-list" id="wifi-list">
                            <div class="wifi-item">
                                <span class="wifi-ssid">等待扫描...</span>
                                <span class="wifi-strength">- dBm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="map-container">
                <div class="card">
                    <div class="card-header">位置地图</div>
                    <div class="card-body">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>WiFi定位演示应用 &copy; 2023</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 初始化地图
        const map = L.map('map').setView([39.9042, 116.4074], 10); // 默认北京
        
        // 添加地图图层
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // 全局变量
        let userMarker = null;
        let accuracyCircle = null;
        let wifiNetworks = [];
        
        // DOM元素
        const locateBtn = document.getElementById('locate-btn');
        const simulateBtn = document.getElementById('simulate-btn');
        const resetBtn = document.getElementById('reset-btn');
        const statusEl = document.getElementById('status');
        const latitudeEl = document.getElementById('latitude');
        const longitudeEl = document.getElementById('longitude');
        const accuracyEl = document.getElementById('accuracy');
        const wifiCountEl = document.getElementById('wifi-count');
        const wifiListEl = document.getElementById('wifi-list');
        const loadingEl = document.querySelector('.loading');
        
        // 模拟WiFi网络数据
        const mockWifiNetworks = [
            { ssid: 'HomeWiFi', strength: -45 },
            { ssid: 'CoffeeShop', strength: -65 },
            { ssid: 'OfficeNetwork', strength: -55 },
            { ssid: 'GuestWiFi', strength: -75 },
            { ssid: 'LibraryFree', strength: -70 },
            { ssid: 'Airport_Free_WiFi', strength: -80 },
            { ssid: 'Starbucks_Guest', strength: -60 }
        ];
        
        // 模拟位置数据（中国几个主要城市）
        const mockLocations = [
            { lat: 39.9042, lng: 116.4074, city: '北京' },
            { lat: 31.2304, lng: 121.4737, city: '上海' },
            { lat: 23.1291, lng: 113.2644, city: '广州' },
            { lat: 30.5728, lng: 104.0668, city: '成都' },
            { lat: 34.3416, lng: 108.9398, city: '西安' }
        ];
        
        // 更新状态显示
        function updateStatus(status, lat, lng, accuracy) {
            statusEl.textContent = status;
            latitudeEl.textContent = lat !== undefined ? lat.toFixed(6) : '-';
            longitudeEl.textContent = lng !== undefined ? lng.toFixed(6) : '-';
            accuracyEl.textContent = accuracy !== undefined ? `${accuracy} 米` : '-';
        }
        
        // 更新WiFi列表显示
        function updateWifiList() {
            wifiCountEl.textContent = wifiNetworks.length;
            
            if (wifiNetworks.length === 0) {
                wifiListEl.innerHTML = '<div class="wifi-item"><span class="wifi-ssid">未检测到WiFi网络</span></div>';
                return;
            }
            
            wifiListEl.innerHTML = '';
            wifiNetworks.forEach(wifi => {
                const wifiItem = document.createElement('div');
                wifiItem.className = 'wifi-item';
                
                const ssidSpan = document.createElement('span');
                ssidSpan.className = 'wifi-ssid';
                ssidSpan.textContent = wifi.ssid;
                
                const strengthSpan = document.createElement('span');
                strengthSpan.className = 'wifi-strength';
                strengthSpan.textContent = `${wifi.strength} dBm`;
                
                wifiItem.appendChild(ssidSpan);
                wifiItem.appendChild(strengthSpan);
                wifiListEl.appendChild(wifiItem);
            });
        }
        
        // 在地图上更新用户位置
        function updateUserLocation(lat, lng, accuracy) {
            // 移除之前的标记和圆圈
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            if (accuracyCircle) {
                map.removeLayer(accuracyCircle);
            }
            
            // 添加新的位置标记
            userMarker = L.marker([lat, lng]).addTo(map)
                .bindPopup(`<b>您的位置</b><br>纬度: ${lat.toFixed(6)}<br>经度: ${lng.toFixed(6)}<br>精度: ${accuracy} 米`)
                .openPopup();
            
            // 添加精度圆圈
            accuracyCircle = L.circle([lat, lng], {
                color: '#4299e1',
                fillColor: '#4299e1',
                fillOpacity: 0.1,
                radius: accuracy
            }).addTo(map);
            
            // 调整地图视图
            map.setView([lat, lng], 15);
        }
        
        // 使用浏览器定位API
        function locateUser() {
            loadingEl.classList.remove('hidden');
            locateBtn.disabled = true;
            updateStatus('定位中...');
            
            // 模拟WiFi扫描（实际中浏览器无法直接扫描WiFi）
            wifiNetworks = [...mockWifiNetworks];
            updateWifiList();
            
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        updateStatus('定位成功', lat, lng, accuracy);
                        updateUserLocation(lat, lng, accuracy);
                        
                        loadingEl.classList.add('hidden');
                        locateBtn.disabled = false;
                    },
                    error => {
                        let errorMessage = '定位失败: ';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += "用户拒绝了定位请求";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += "位置信息不可用";
                                break;
                            case error.TIMEOUT:
                                errorMessage += "定位请求超时";
                                break;
                            default:
                                errorMessage += "未知错误";
                                break;
                        }
                        
                        updateStatus(errorMessage);
                        loadingEl.classList.add('hidden');
                        locateBtn.disabled = false;
                        
                        // 定位失败时使用模拟数据
                        alert(`${errorMessage}，将使用模拟数据进行演示。`);
                        useMockLocation();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                updateStatus('浏览器不支持定位功能');
                loadingEl.classList.add('hidden');
                locateBtn.disabled = false;
                
                // 浏览器不支持定位时使用模拟数据
                alert('您的浏览器不支持定位功能，将使用模拟数据进行演示。');
                useMockLocation();
            }
        }
        
        // 使用模拟位置
        function useMockLocation() {
            const randomLocation = mockLocations[Math.floor(Math.random() * mockLocations.length)];
            const accuracy = Math.floor(Math.random() * 100) + 50; // 50-150米精度
            
            updateStatus('使用模拟数据', randomLocation.lat, randomLocation.lng, accuracy);
            updateUserLocation(randomLocation.lat, randomLocation.lng, accuracy);
            
            // 更新WiFi列表
            wifiNetworks = [...mockWifiNetworks];
            updateWifiList();
        }
        
        // 重置地图
        function resetMap() {
            if (userMarker) {
                map.removeLayer(userMarker);
                userMarker = null;
            }
            if (accuracyCircle) {
                map.removeLayer(accuracyCircle);
                accuracyCircle = null;
            }
            
            map.setView([39.9042, 116.4074], 10);
            updateStatus('等待定位...');
            latitudeEl.textContent = '-';
            longitudeEl.textContent = '-';
            accuracyEl.textContent = '-';
            
            wifiNetworks = [];
            updateWifiList();
        }
        
        // 事件监听
        locateBtn.addEventListener('click', locateUser);
        simulateBtn.addEventListener('click', useMockLocation);
        resetBtn.addEventListener('click', resetMap);
        
        // 初始化WiFi列表
        updateWifiList();
    </script>
</body>
</html>